@model UltimaPrueba.Models.ViewModels.ReservaVM

@{
    ViewData["Title"] = "Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<head>
    <link href="~/css/reservacrearstyle.css" rel="stylesheet" />
</head>

<div class="container-create mt-3">

    <h1>Detalles Reserva</h1>

    <div class="container-form-create-reserva">

        <form asp-action="Crear" asp-controller="Reservas" id="reservaForm">

            <div class="form-create">

                <input type="hidden" asp-for="oReserva.IdReserva" />

                <div class="box-1 p-4 d-sm-flex mt-4">
                    <div class="nom-ape-dir">
                        <div class="d-sm-flex mb-3">
                            <label class="form-label">Nombres</label>
                            <input type="text" id="inputNombre" class="form-control form-control-sm" disabled>
                        </div>
                        <div class="d-sm-flex mb-3">
                            <label class="form-label">Apeliidos</label>
                            <input type="text" id="inputApellido" class="form-control form-control-sm" disabled>
                        </div>
                    </div>
                    <div class="doc-cor-tel">
                        <div class="d-sm-flex">
                            <input type="text" id="inputTDocumento" class="form-control form-control-sm" disabled>
                            <div class="mb-5">
                                <div class="d-sm-flex">
                                    <label class="form-label">Nro. Documento</label>
                                    <input class="form-control form-control-sm" id="inputDocumento" autocomplete="off" onkeyup="buscarCliente(this.value)" asp-for="oReserva.NroDocumentoCliente" disabled>
                                </div>
                            </div>
                        </div>

                        <div class="d-sm-flex">
                            <div class="label-correo-telefono mb-2">
                                <label class="form-label">Correo</label>
                                <label class="form-label">Celular</label>
                            </div>
                            <div class="input-correo-telefono">
                                <input type="text" id="inputCorreo" class="form-control form-control-sm mb-2" disabled>
                                <input type="text" id="inputCelular" class="form-control form-control-sm" disabled>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="box-2 p-4 d-sm-flex mt-4">
                    <div class="label-info-reserva">
                        <div class="d-sm-flex mb-2 label-input">

                            <div>
                                <label class="form-label">Inicio</label>
                                <input type="date" class="form-control form-control-sm" id="fechaInicio" asp-for="oReserva.FechaInicio" readonly>
                            </div>
                        </div>
                        <div class="d-sm-flex mb-2 label-input">

                            <div>
                                <label class="form-label">Fin</label>
                                <input type="date" class="form-control form-control-sm" id="fechaFin" asp-for="oReserva.FechaFinalizacion" readonly>
                            </div>

                        </div>
                        <div class="d-sm-flex mb-2 label-input">

                            <div>
                                <label class="form-label">Sub Total</label>
                                <input type="text" id="inputSubTotal" class="form-control form-control-sm" asp-for="oReserva.SubTotal" readonly>
                            </div>

                        </div>
                        <div class="d-sm-flex mb-2 label-input">
                            <div class="d-sm-flex">
                                <label class="form-label">Descuento</label>
                                <input type="text" id="descuento" class="form-control form-control-sm" asp-for="oReserva.Descuento" readonly>
                                <span class="input-group-text" id="descuento-addon">%</span>
                            </div>

                        </div>
                        <div class="d-sm-flex mb-2 label-input">
                            <div>
                                <label class="form-label">IVA 19%</label>
                                <input type="text" id="inputIva" class="form-control form-control-sm" asp-for="oReserva.Iva" readonly>
                            </div>

                        </div>


                    </div>
                    <div class="label-info-reserva">
                        <div class="d-sm-flex mb-2 label-input">

                            <div>
                                <label class="form-label">Fecha Reserva</label>
                                <input type="text" id="fechaActual" class="form-control form-control-sm" asp-for="oReserva.FechaReserva" readonly>
                            </div>

                        </div>
                        <div class="d-sm-flex mb-2 label-input">

                            <div>
                                <label class="form-label">Nro. Personas</label>
                                <input type="text" id="nroPersonas" class="form-control form-control-sm" asp-for="oReserva.NroPersonas" readonly>
                            </div>

                        </div>
                        <div class="d-sm-flex mb-2 label-input">

                            <div>
                                <label class="form-label">Total</label>
                                <input type="text" id="inputCostoTotal" class="form-control form-control-sm" asp-for="oReserva.MontoTotal" readonly>
                            </div>
                        </div>
                        <div class="d-sm-flex mb-2 label-input">
                            <div>
                                <label class="form-label" asp-for="oReserva.MetodoPago">Metodo Pago</label>
                                <select class="form-select form-select-sm" asp-for="oReserva.MetodoPago" asp-items="@Model.oListaMetodoPagos" disabled>
                                </select>
                            </div>
                        </div>
                        <div class="d-sm-flex label-input">
                            <div>
                                <label class="form-label" asp-for="oReserva.IdEstadoReserva">Estado</label>
                                <select class="form-select form-select-sm" asp-for="oReserva.IdEstadoReserva" asp-items="@Model.oListaEstados" disabled>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="box-3 p-4 d-sm-flex mt-4">

                    <div>
                        <div class="select-paquete mb-3">

                            <label class="form-label mt-3">Paquete Seleccionado</label>

                            <div class="select-span">
                                <select id="selectPaquetes" class="form-select form-select-sm selectPaquete" disabled>
                                    <option value="@ViewBag.PaqueteAsociado.IdPaquete" selected>@ViewBag.PaqueteAsociado.NomPaquete</option>
                                </select>
                            </div>
                        </div>

                        <div class="d-sm-flex item-info-paquete mb-3">
                            <label class="form-label">Costo</label>
                            <input type="text" id="inputCostoPaquete" class="form-control form-control-sm" disabled>
                        </div>

                    </div>

                     <div>
                        <label class="form-label mt-3">Servicios Seleccionados</label>
                        <table id="tablaServiciosPaquete" class="table table-st table-paquetes">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Cantidad</th>
                                    <th>Costo</th>
                                </tr>
                            </thead>
                            <tbody>
                                @for (int i = 0; i < ViewBag.ServiciosAsociados.Count; i++)
                                {
                                    <tr>
                                        <td>@ViewBag.ServiciosAsociados[i].oServicio.NomServicio</td>
                                        <td><input style="max-width:80px;text-align: center" value="@ViewBag.CantidadesServiciosAsociados[i]" onchange="cambiarCantidad(this)" oninput="formatoNumero(this)" disabled></td>
                                        <td>@string.Format("{0:C0}", ViewBag.ServiciosAsociados[i].Precio)</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div> 

                </div>

            </div>

        </form>

        <div class="buttons d-flex" style="gap: 10px">
            <form asp-action="DescargarPDF" asp-controller="Reservas">
                <input type="hidden" name="idReserva" value="@Model.oReserva.IdReserva"></input>
                <button class="btn btn-success" type="submit">Descargar PDF</button>
            </form>
            <a style="padding-top: 7px" class="btn btn-dark btn-sm" asp-action="Index" asp-controller="Reservas">Volver</a>
        </div>

    </div>

</div>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="~/js/metodosscript.js"></script>
<script src="~/js/reservascript.js"></script>

<script>

    var documentoCliente = $('#inputDocumento').val();
    buscarCliente(documentoCliente);

    var subTotal = parseFloat($('#inputSubTotal').val());
    var iva = parseFloat($('#inputIva').val());
    var total = parseFloat($('#inputCostoTotal').val());

    $('#inputSubTotal').val(formatoCostoInput(subTotal));
    $('#inputIva').val(formatoCostoInput(iva));
    $('#inputCostoTotal').val(formatoCostoInput(total));

    var idPaqueteSelected = $('#selectPaquetes').val();

    $.ajax({
        url: '/Reservas/ObtenerInfoBasicaPaquete',
        type: 'GET',
        data: { reservaId: @Model.oReserva.IdReserva },
        dataType: 'json',
        success: function (data) {
            $('#inputCostoPaquete').val(formatoCostoInput(data.costo));
        },
        error: function () {
            console.error('Error al obtener la informacion del paquete.');
        }
    });


</script>